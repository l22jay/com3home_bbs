<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase ê²Œì‹œíŒ</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <style>
        #post-container { display: none; }
    </style>
</head>
<body>
    <h1>ğŸ“Œ Supabase ê²Œì‹œíŒ</h1>

    <div id="post-container">
        <h2 id="post-title"></h2>
        <p id="post-content"></p>
        <a href="/" onclick="goHome(event)">â¬…ï¸ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>

    <div id="post-list"></div>

    <script>
        const SUPABASE_URL = "https://aypexxxatdakzzlgnbng.supabase.co";
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...";
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        async function fetchPosts() {
            const { data, error } = await supabase.from("posts").select("*").order("created_at", { ascending: false });

            if (error) { console.error("ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨", error); return; }

            const postList = document.getElementById("post-list");
            postList.innerHTML = "";

            data.forEach(post => {
                const postElement = document.createElement("div");
                postElement.innerHTML = `
                    <h2><a href="/${post.id}" onclick="navigateToPost(event, '${post.id}')">${post.title}</a></h2>
                    <p>${post.content.substring(0, 100)}...</p>
                `;
                postList.appendChild(postElement);
            });
        }

        async function fetchPost(postId) {
            const { data, error } = await supabase.from("posts").select("*").eq("id", postId).single();

            if (error || !data) {
                document.getElementById("post-content").innerText = "ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
                return;
            }

            document.getElementById("post-title").innerText = data.title;
            document.getElementById("post-content").innerHTML = data.content.replace(/\n/g, "<br>");

            // UI ì „í™˜
            document.getElementById("post-list").style.display = "none";
            document.getElementById("post-container").style.display = "block";
        }

        function navigateToPost(event, postId) {
            event.preventDefault();
            history.pushState(null, "", `/${postId}`);
            fetchPost(postId);
        }

        function goHome(event) {
            event.preventDefault();
            history.pushState(null, "", "/");
            document.getElementById("post-container").style.display = "none";
            document.getElementById("post-list").style.display = "block";
            fetchPosts();
        }

        // URLì—ì„œ ID ê°ì§€í•´ ê²Œì‹œê¸€ ë¡œë“œ
        window.onload = function () {
            const postId = window.location.pathname.substring(1);
            if (postId) fetchPost(postId);
            else fetchPosts();
        };

        // ë’¤ë¡œê°€ê¸°/ì•ìœ¼ë¡œê°€ê¸° ì´ë²¤íŠ¸ ì²˜ë¦¬
        window.onpopstate = function () {
            const postId = window.location.pathname.substring(1);
            if (postId) fetchPost(postId);
            else goHome(event);
        };
    </script>
</body>
</html>
